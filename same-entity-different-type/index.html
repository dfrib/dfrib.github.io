<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <title>
    Pop quiz: same entity, with different type depending on context and/or scope? // [unfold] Bits of awareness
  </title>

  <link href="https://gmpg.org/xfn/11" rel="profile">
<meta http-equiv="content-type" content="text/html; charset=utf-8">


<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

<meta name="description" content="">
<meta name="keywords" content="">
<meta name="author" content="[David Friberg]">
<meta name="generator" content="Hugo 0.58.3" />


  <meta property="og:title" content="Pop quiz: same entity, with different type depending on context and/or scope?" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:locale" content="en_US" />
<meta property="og:url" content="//dfrib.github.io/same-entity-different-type/" />


  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/base-min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/pure-min.css">
  
  
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/grids-responsive-min.css">
  
  

   
   <link rel="stylesheet" href="//dfrib.github.io/css/redlounge.css">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
  <link href='//fonts.googleapis.com/css?family=Raleway:400,200,100,700,300,500,600,800' rel='stylesheet' type='text/css'>
  <link href='//fonts.googleapis.com/css?family=Libre+Baskerville:400,700,400italic' rel='stylesheet' type='text/css'>

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="//dfrib.github.io/touch-icon-144-precomposed.png">
  <link rel="shortcut icon" type="image/x-icon" href="//dfrib.github.io/img/favicon.png">

  
  <link href="" rel="alternate" type="application/rss+xml" title="[unfold] Bits of awareness" />

  


  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css">
  <link rel="stylesheet" href="//dfrib.github.io/css/override.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
  <script
    charset="UTF-8"
    src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/lisp.min.js"></script>
  <script
    charset="UTF-8"
    src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/swift.min.js"></script>
  <script
    charset="UTF-8"
    src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/cmake.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>


  

  

  

  
</head>

<body>
	

	<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
  <div class="header">
    

	

    <h1 class="brand-title">[unfold]</h1>
    <h2 class="brand-tagline">Bits of awareness</h2>

    <nav class="nav">
      <ul class="nav-list">
        
        
          <li class="nav-item"><span class="nav-item-separator">//</span><a href="//dfrib.github.io/">Home</a></li>
        
          <li class="nav-item"><span class="nav-item-separator">//</span><a href="//dfrib.github.io/categories/cplusplus">C&#43;&#43;</a></li>
        
          <li class="nav-item"><span class="nav-item-separator">//</span><a href="//dfrib.github.io/categories/emacs">Emacs</a></li>
        
      </ul>
    </nav>

    
    <div class="social-buttons">
      
        
        <a href="https://github.com/dfrib" target="_blank"><i class ='fa fa-github'></i></a>
        
      
        
        <a href="https://www.linkedin.com/in/david-friberg-7642863a" target="_blank"><i class ='fa fa-linkedin'></i></a>
        
      
        
        <a href="https://stackoverflow.com/users/4573247/dfri?tab=profile" target="_blank"><i class ='fa fa-stack-overflow'></i></a>
        
      
      
    </div>
    

  </div>
</div>

	
	

    <div class="content pure-u-1 pure-u-md-3-4">
		<a name="top"></a>
		

		
			
		    
			
		    
		    
		    
	    
  		<section class="post">
            <h1 class="post-title">
              <a href="//dfrib.github.io/same-entity-different-type/">Pop quiz: same entity, with different type depending on context and/or scope?</a>
            </h1>
            <h3 class="post-subtitle">
            	
            </h3>
            
            	
                
            	
            	
            
            	
            		
            		
            	
            

			
			
				<div class="post-categories">
				
					<a class="post-category post-category-cplusplus" href="//dfrib.github.io/categories/cplusplus">cplusplus</a>
				
				</div>
			
            
				<div class="tags-list">
					<span class="dark-red">Tags</span><span class="decorative-marker">//</span>
					
	                <a class="post-tag post-tag-cpp" href="//dfrib.github.io/tags/cpp">cpp</a>,
	                
	                <a class="post-tag post-tag-quiz" href="//dfrib.github.io/tags/quiz">quiz</a>,
	                
				</div>
			

			

			

            <blockquote>
<p>Is(/are) there any scenario(s) where a name, which refers to an entity, actually
refers to a different types (whilst still referring to the same entity)
depending on context and/or scope? Or, to put it in another way, is(/are) there
any scenario(s) where the type of a named entity changes depending on context
and/or scope?</p>
</blockquote>

<p>where an <em>entity</em> is, as per <a href="https://timsong-cpp.github.io/cppwp/n4659/basic#3">{basic}/3</a>:</p>

<blockquote>
<p>[An entity is] a value, object, reference, function, enumerator, type, class
member, bit-field, template, template specialization, namespace, or parameter
pack.</p>
</blockquote>

<p>Note that we&rsquo;re not looking for cases where a given name (or, formally,
identifier) can refer to different entities due to overload resolution (it shall
refer to the same entity!).</p>

<h2 id="answer">Answer</h2>

<p><details>
<summary>
Expand
</summary>
<p class="details"></p>

<p>The answer is the enumerator of an enum. As governed by <a href="https://timsong-cpp.github.io/cppwp/n4659/dcl.enum#5">{dcl.enum}/5</a> [extract,
<strong>emphasis</strong> mine]:</p>

<blockquote>
<p><strong>Following the closing brace</strong> of an enum-specifier, <strong>each enumerator has the
type of its enumeration</strong>. If the underlying type is fixed, the type of each
enumerator <strong>prior to the closing brace is the underlying type</strong> [&hellip;]. If the
underlying type <strong>is not fixed</strong>, <strong>the type of each enumerator prior to the
closing brace</strong> is determined as follows:</p>

<ul>
<li>[&hellip;]</li>
</ul>
</blockquote>

<p>in simple terms, the type of each enumerator changes depending on whether its
viewed from within the definition of the enumeration or from outside of it.</p>

<p>Inside the definition of the enum (no matter if it is a scoped enum or not), the
type of the enumerators (ignoring some details in <a href="https://timsong-cpp.github.io/cppwp/n4659/dcl.enum#5.1">{dcl.enum}/5.1</a> and
<a href="https://timsong-cpp.github.io/cppwp/n4659/dcl.enum#5.3">{dcl.enum}/5.3</a> for enumerations where the underlying type is not fixed) is that
of the underlying type, whereas outside of the definition of the enum, the type
of the same enumerators have is that of the enum itself.</p>

<p>We may show it in practice with an example, where we start by defining a trait
that wraps a type identity check (<code>std::is_same</code>) whilst forwarding a
<code>constexpr</code> value:</p>
<div class="highlight"><pre style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#000080">// util.h
</span><span style="color:#000080"></span><span style="color:#000080">#pragma once
</span><span style="color:#000080">#include</span> <span style="color:#000080">&lt;type_traits&gt;</span><span style="color:#000080">
</span><span style="color:#000080"></span>
<span style="color:#000080">// Forward a constexpr value whilst statically asserting
</span><span style="color:#000080">// type identity between the two type template parameters.
</span><span style="color:#000080"></span><span style="color:#cdcd00">template</span> <span style="color:#39c">&lt;</span><span style="color:#cdcd00">typename</span> T, <span style="color:#cdcd00">typename</span> U, <span style="color:#00cd00">int</span> VALUE<span style="color:#39c">&gt;</span>
<span style="color:#cdcd00">struct</span> is_same_and_value {
    <span style="color:#cdcd00">static_assert</span>(std<span style="color:#39c">::</span>is_same_v<span style="color:#39c">&lt;</span>T, U<span style="color:#39c">&gt;</span>, <span style="color:#cd0000">&#34;&#34;</span>);
    <span style="color:#cdcd00">static</span> <span style="color:#cdcd00">constexpr</span> <span style="color:#00cd00">int</span> value <span style="color:#39c">=</span> VALUE;
};

<span style="color:#cdcd00">template</span> <span style="color:#39c">&lt;</span><span style="color:#cdcd00">typename</span> T, <span style="color:#cdcd00">typename</span> U, <span style="color:#00cd00">int</span> VALUE<span style="color:#39c">&gt;</span>
<span style="color:#cdcd00">constexpr</span> <span style="color:#00cd00">int</span> is_same_and_value_v <span style="color:#39c">=</span>
    is_same_and_value<span style="color:#39c">&lt;</span>T, U, VALUE<span style="color:#39c">&gt;::</span>value;
</code></pre></div>
<p>and thereafter make use of this trait to check the type identity of an
enumerator from within an enum definition whilst simultaneously initializing
another enumerator with a <code>constexpr</code> value.</p>
<div class="highlight"><pre style="color:#ccc;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#000080">#include</span> <span style="color:#000080">&lt;type_traits&gt;</span><span style="color:#000080">
</span><span style="color:#000080">#include</span> <span style="color:#000080">&#34;util.h&#34;</span><span style="color:#000080">
</span><span style="color:#000080"></span>
<span style="color:#cdcd00">enum</span> <span style="color:#cdcd00">class</span><span style=""> </span><span style="color:#00cdcd">Foo</span><span style="color:#39c">:</span> <span style="color:#00cd00">int</span>;
<span style="color:#cdcd00">constexpr</span> Foo f <span style="color:#39c">=</span> <span style="color:#cdcd00">static_cast</span><span style="color:#39c">&lt;</span>Foo<span style="color:#39c">&gt;</span>(<span style="color:#cd00cd">0</span>);

<span style="color:#cdcd00">enum</span> <span style="color:#cdcd00">class</span><span style=""> </span><span style="color:#00cdcd">Foo</span><span style="color:#39c">:</span> <span style="color:#00cd00">int</span> {
  A,
  <span style="color:#000080">// A (and other enumerators) are of the same type as the
</span><span style="color:#000080"></span>  <span style="color:#000080">// underlying type (&#39;int&#39;) within the scope of the enum definition.
</span><span style="color:#000080"></span>  B <span style="color:#39c">=</span> is_same_and_value_v<span style="color:#39c">&lt;</span><span style="color:#cdcd00">decltype</span>(A), <span style="color:#00cd00">int</span>, <span style="color:#cd00cd">1</span><span style="color:#39c">&gt;</span>,
  <span style="color:#000080">// Whereas the &#39;f&#39;, however, naturally has the type (const) &#39;Foo&#39;.
</span><span style="color:#000080"></span>  C <span style="color:#39c">=</span> is_same_and_value_v<span style="color:#39c">&lt;</span><span style="color:#cdcd00">decltype</span>(f), <span style="color:#cdcd00">const</span> Foo, <span style="color:#cd00cd">5</span><span style="color:#39c">&gt;</span>,
};

<span style="color:#000080">// Outside of the definition, the type of each enumerator, however,
</span><span style="color:#000080">// is no longer that of the underlying type, but that of the enum.
</span><span style="color:#000080"></span><span style="color:#cdcd00">static_assert</span>(std<span style="color:#39c">::</span>is_same_v<span style="color:#39c">&lt;</span><span style="color:#cdcd00">decltype</span>(Foo<span style="color:#39c">::</span>A), Foo<span style="color:#39c">&gt;</span>, <span style="color:#cd0000">&#34;&#34;</span>);
<span style="color:#cdcd00">static_assert</span>(<span style="color:#39c">!</span>std<span style="color:#39c">::</span>is_same_v<span style="color:#39c">&lt;</span><span style="color:#cdcd00">decltype</span>(Foo<span style="color:#39c">::</span>B), <span style="color:#00cd00">int</span><span style="color:#39c">&gt;</span>, <span style="color:#cd0000">&#34;&#34;</span>);

<span style="color:#00cd00">int</span> main() {}
</code></pre></div>
<p></p>
</details></p>

			

			
			
			
			
	        
	        
	        
	        
			
			    

                
				
				

			
				<div class="paging">
					<span class="paging-label">More Reading</span>

					

                    
					<div class="paging-newer">
						<span class="dark-red">Older</span><span class="decorative-marker">//</span>
						<a class="paging-link" href="//dfrib.github.io/fickle-aggregate/">The fickle aggregate</a>
		            </div>
		            
	            </div>
                    

                    
                    
          </section>
          
          	<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "dfrib" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
          
        
      <div class="footer">
	<hr class="thin" />
	<div class="pure-menu pure-menu-horizontal pure-menu-open">
		<ul class="footer-menu">
		
		</ul>
	</div>

	<p>&copy; 2019-2020 David Friberg</p>
</div>
    </div>
  </div>
	

	

  
</body>
</html>
